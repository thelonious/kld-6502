let DFARunner = require('kld-regex').DFARunner;

let tokens = [
    /*  0 */ { type: "whitespace",   pattern: "[\\ \\t]+" },
    /*  1 */ { type: "eol",          pattern: "(\\r\\n|\\r|\\n)"},
    /*  2 */ { type: "comment",      pattern: ";[^\\r\\n]*" },
    /*  3 */ { type: "mnemonic",     pattern: "(adc|and|asl|bcc|bcs|beq|bit|bmi|bne|bpl|brk|bvc|bvs|clc|cld|cli|clv|cmp|cpx|cpy|dec|dex|dey|eor|inc|inx|iny|jmp|jsr|lda|ldx|ldy|lsr|nop|ora|pha|php|pla|plp|rol|ror|rti|rts|sbc|sec|sed|sei|sta|stx|sty|tax|tay|tsx|txa|txs|tya)", caseSensitive: false },
    /*  4 */ { type: "directive",    pattern: "\\.(db|ds|dw|include|org)", caseSensitive: false },
    /*  5 */ { type: "equate",       pattern: "(\\.equ?|=)", caseSensitive: false },
    /*  6 */ { type: "lowByte",      pattern: "\\.l(ow)?", caseSensitive: false },
    /*  7 */ { type: "highByte",     pattern: "\\.h(igh)?", caseSensitive: false },
    /*  8 */ { type: "accumulator",  pattern: "a", caseSensitive: false },
    /*  9 */ { type: "register",     pattern: "(x|y)", caseSensitive: false },
    /* 10 */ { type: "colon",        pattern: ":" },
    /* 11 */ { type: "comma",        pattern: "," },
    /* 12 */ { type: "pound",        pattern: "#" },
    /* 13 */ { type: "lparen",       pattern: "\\(" },
    /* 14 */ { type: "rparen",       pattern: "\\)" },
    /* 15 */ { type: "charConstant", pattern: "'.'" },
    /* 16 */ { type: "charString",   pattern: "\\\".+\\\"" },
    /* 17 */ { type: "binaryNumber", pattern: "%[01]+" },
    /* 18 */ { type: "hexNumber",    pattern: "\\$[a-f0-9]+", caseSensitive: false },
    /* 19 */ { type: "number",       pattern: "-?(0|[1-9][0-9]*)" },
    /* 20 */ { type: "plus",         pattern: "\\+" },
    /* 21 */ { type: "times",        pattern: "\\*" },
    /* 22 */ { type: "identifier",   pattern: "[a-z_][a-z0-9_]*", caseSensitive: false }
];

let table = [
  [ [-9,1,2,-2,3,-18,1,-1,4,5,6,7,-1,8,9,10,11,12,13,14,15,-1,16,2321,18,19,-1,20,-33,21,-1,22,23,24,25,26,789,27,28,21,29,21,30,31,32,21,33,34,35,789,36,37,21,-133], -1 ],
  [ [-9,1,-22,1,-223], 0 ],
  [ [-256], 1 ],
  [ [-10,38,-245], 1 ],
  [ [2599,-1,551,-1,61991], -1 ],
  [ [-256], 12 ],
  [ [-48,2600,-39,1576,-153], -1 ],
  [ [-48,553,-206], -1 ],
  [ [2602,-1,554,-1,61994], -1 ],
  [ [-256], 13 ],
  [ [-256], 14 ],
  [ [-256], 21 ],
  [ [-256], 20 ],
  [ [-256], 11 ],
  [ [-48,16,2321,-198], -1 ],
  [ [-100,43,44,-2,45,46,-2,47,-2,48,-144], -1 ],
  [ [-256], 19 ],
  [ [-48,2609,-198], 19 ],
  [ [-256], 10 ],
  [ [2610,-1,562,-1,62002], 2 ],
  [ [-256], 5 ],
  [ [-48,2611,-37,51,-1,6707,-133], 22 ],
  [ [-48,2611,-37,51,-1,819,52,2355,53,1075,54,1843,-133], 8 ],
  [ [-48,2611,-37,51,-1,563,55,51,56,819,57,819,58,59,51,60,51,61,819,62,1075,-133], 22 ],
  [ [-48,2611,-37,51,-1,2867,63,64,563,65,2611,-133], 22 ],
  [ [-48,2611,-37,51,-1,1075,66,5427,-133], 22 ],
  [ [-48,2611,-37,51,-1,3635,67,2867,-133], 22 ],
  [ [-48,2611,-37,51,-1,3379,68,3123,-133], 22 ],
  [ [-48,2611,-37,51,-1,3123,69,1331,70,1843,-133], 22 ],
  [ [-48,2611,-37,51,-1,819,71,3635,72,1843,-133], 22 ],
  [ [-48,2611,-37,51,-1,3635,73,2867,-133], 22 ],
  [ [-48,2611,-37,51,-1,4403,74,2099,-133], 22 ],
  [ [-48,2611,-37,51,-1,1843,75,819,76,3635,-133], 22 ],
  [ [-48,2611,-37,51,-1,3635,77,1075,78,1587,-133], 22 ],
  [ [-48,2611,-37,51,-1,51,79,563,80,3635,81,1587,-133], 22 ],
  [ [-48,2611,-37,51,-1,82,4403,83,1075,84,85,51,-133], 22 ],
  [ [-48,2611,-37,51,-1,6707,-133], 9 ],
  [ [-48,2611,-37,51,-1,6707,-133], 9 ],
  [ [-256], 1 ],
  [ [2599,-1,551,-1,5159,86,56615], -1 ],
  [ [-48,2600,-39,1576,-153], 18 ],
  [ [-48,553,-206], 17 ],
  [ [-39,87,-216], -1 ],
  [ [-98,88,-16,89,-3,90,-136], -1 ],
  [ [-113,91,-142], -1 ],
  [ [-105,92,-150], 7 ],
  [ [-110,93,-145], -1 ],
  [ [-111,94,-144], 6 ],
  [ [-114,95,-141], -1 ],
  [ [-48,2609,-198], 19 ],
  [ [2610,-1,562,-1,62002], 2 ],
  [ [-48,2611,-37,51,-1,6707,-133], 22 ],
  [ [-48,2611,-37,51,-1,563,96,5939,-133], 22 ],
  [ [-48,2611,-37,51,-1,819,97,5683,-133], 22 ],
  [ [-48,2611,-37,51,-1,2867,98,3635,-133], 22 ],
  [ [-48,2611,-37,51,-1,563,99,3891,100,1843,-133], 22 ],
  [ [-48,2611,-37,51,-1,4147,101,2355,-133], 22 ],
  [ [-48,2611,-37,51,-1,4915,102,1587,-133], 22 ],
  [ [-48,2611,-37,51,-1,2099,103,4403,-133], 22 ],
  [ [-48,2611,-37,51,-1,1075,104,5427,-133], 22 ],
  [ [-48,2611,-37,51,-1,2867,105,3635,-133], 22 ],
  [ [-48,2611,-37,51,-1,2611,106,3891,-133], 22 ],
  [ [-48,2611,-37,51,-1,563,107,3891,108,1843,-133], 22 ],
  [ [-48,2611,-37,51,-1,563,109,110,1075,111,3123,112,1075,-133], 22 ],
  [ [-48,2611,-37,51,-1,3891,113,2611,-133], 22 ],
  [ [-48,2611,-37,51,-1,5939,114,115,51,-133], 22 ],
  [ [-48,2611,-37,51,-1,563,116,5171,117,118,51,-133], 22 ],
  [ [-48,2611,-37,51,-1,4403,119,2099,-133], 22 ],
  [ [-48,2611,-37,51,-1,563,120,5171,121,122,51,-133], 22 ],
  [ [-48,2611,-37,51,-1,3891,123,2611,-133], 22 ],
  [ [-48,2611,-37,51,-1,4403,124,2099,-133], 22 ],
  [ [-48,2611,-37,51,-1,125,5683,126,127,51,-133], 22 ],
  [ [-48,2611,-37,51,-1,4403,128,2099,-133], 22 ],
  [ [-48,2611,-37,51,-1,3891,129,2611,-133], 22 ],
  [ [-48,2611,-37,51,-1,130,6451,-133], 22 ],
  [ [-48,2611,-37,51,-1,131,3635,132,2611,-133], 22 ],
  [ [-48,2611,-37,51,-1,133,3635,134,2611,-133], 22 ],
  [ [-48,2611,-37,51,-1,2867,135,1331,136,2099,-133], 22 ],
  [ [-48,2611,-37,51,-1,2099,137,2355,138,1843,-133], 22 ],
  [ [-48,2611,-37,51,-1,563,139,5939,-133], 22 ],
  [ [-48,2611,-37,51,-1,563,140,141,1075,142,4403,-133], 22 ],
  [ [-48,2611,-37,51,-1,143,5683,144,145,51,-133], 22 ],
  [ [-48,2611,-37,51,-1,5939,146,147,51,-133], 22 ],
  [ [-48,2611,-37,51,-1,5939,148,563,-133], 22 ],
  [ [-48,2611,-37,51,-1,149,4403,150,1843,-133], 22 ],
  [ [-48,2611,-37,51,-1,151,6451,-133], 22 ],
  [ [2599,-1,551,-1,5159,86,56615], 16 ],
  [ [-256], 15 ],
  [ [-256], 4 ],
  [ [-256], 4 ],
  [ [-256], 4 ],
  [ [-117,152,-138], 5 ],
  [ [-103,153,-152], -1 ],
  [ [-99,154,-156], -1 ],
  [ [-119,155,-136], -1 ],
  [ [-103,156,-152], -1 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-48,2611,-37,51,-1,6707,-133], 3 ],
  [ [-256], 5 ],
  [ [-104,157,-151], -1 ],
  [ [-108,158,-147], -1 ],
  [ [-256], 6 ],
  [ [-256], 4 ],
  [ [-256], 7 ],
  [ [-117,159,-138], -1 ],
  [ [-100,160,-155], -1 ],
  [ [-101,161,-154], -1 ],
  [ [-256], 4 ],
];

class Lexer {
	constructor() {
		this.runner = new DFARunner(table);
		this._text = "";
		this.offset = 0;
		this.length = 0;
	}

	get text() {
		return this._text;
	}

	set text(value) {
		this._text = value;
		this.offset = 0;
		this.length = value.length;
	}

	next() {
		var result = null;
				
		if (this.offset < this.length) {
			result = this.runner.next(this._text, this.offset, this.length);

			if (result !== null) {
				result.token = tokens[result.type];
				
				this.offset = result.endingOffset;
			}
			else {
				console.log("result is null");
			}
		}
		
		return result;
	}
}

module.exports = Lexer;
